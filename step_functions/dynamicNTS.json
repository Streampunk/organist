{
  "Comment": "Example NTS state machine",
  "StartAt": "ParallelSetup",
  "States": {
    "ParallelSetup": {
      "Type" : "Parallel",
      "Branches": [
        {
          "StartAt": "BringUpCloud1",
          "States": {
            "BringUpCloud1": {
              "Type": "Task",
              "InputPath" : "$.mixParams",
              "Resource": "arn:aws:lambda:eu-west-1:258641003975:function:newInstance",
              "Next": "ExtractInstanceDetails1",
              "ResultPath" : "$.reservation",
              "OutputPath" : "$"
            },
            "ExtractInstanceDetails1": {
              "Type": "Pass",
              "InputPath": "$.reservation.Reservations[0].Instances[0]",
              "ResultPath": "$.instanceDetails",
              "OutputPath": "$",
              "Next": "InstallMixCapabilities"
            },
            "InstallMixCapabilities": {
              "Type": "Wait",
              "Seconds": 5,
              "End" : true
            }
          }

        }, {
          "StartAt": "BringUpCloud2",
          "States": {
            "BringUpCloud2": {
              "Type": "Task",
              "InputPath": "$.encodeParams",
              "Resource": "arn:aws:lambda:eu-west-1:258641003975:function:newInstance",
              "Next": "ExtractInstanceDetails2",
              "ResultPath" : "$.reservation",
              "OutputPath" : "$"
            },
            "ExtractInstanceDetails2": {
              "Type": "Pass",
              "InputPath": "$.reservation.Reservations[0].Instances[0]",
              "ResultPath": "$.instanceDetails",
              "OutputPath": "$",
              "Next": "InstallEncodeCapabilities"
            },
            "InstallEncodeCapabilities": {
              "Type": "Wait",
              "Seconds": 4,
              "End" : true
            }
          }
        }
      ],
      "Next": "DeployMix"
    },
    "DeployMix": {
      "Type": "Wait",
      "Seconds": 3,
      "Next" : "DeployEncode"
    },
    "DeployEncode": {
      "Type": "Wait",
      "Seconds": 4,
      "Next": "RunState"
    },
    "RunState": {
      "Type": "Wait",
      "Seconds": 13,
      "Next": "ParallelTearDown"
    },
    "ParallelTearDown": {
      "Type": "Parallel",
      "Branches": [
        {
          "StartAt": "TearDownCloud1",
          "States": {
            "TearDownCloud1" : {
              "Type": "Task",
              "InputPath" : "$[0]['mixParams']",
              "Resource": "arn:aws:lambda:eu-west-1:258641003975:function:terminateInstance",
              "End": true
            }
          }
        }, {
          "StartAt": "TearDownCloud2",
          "States": {
            "TearDownCloud2": {
              "Type": "Task",
              "InputPath" : "$[1]['encodeParams']",
              "Resource": "arn:aws:lambda:eu-west-1:258641003975:function:terminateInstance",
              "End": true
            }
          }
        }
      ],
      "End": true
    }
  }
}
